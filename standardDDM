# packages 
# import pandas as pd
import numpy as np
import random
import math
import numba as nb
from Model import Model
from file_input import *
from variables import Variables
import pandas as pd
import sys

"""
This class represents the standard drift diffusion model 
"""

class standardDDM(Model):

    param_number = 4
    global bounds
    global data
    parameter_names = ['alpha', 'beta', 'delta', 'tau']
    variables = Variables()


    def __init__(self):
        """
        Initializes a standard diffusion model object. 
        """
        self.data = getRTData()
        self.bounds = [(0,10),(0,1),(1,20),(0,min(self.data['rt']))]
        super().__init__(self.param_number, self.bounds, self.parameter_names)

    # @staticmethod
    @nb.jit(nopython=True, cache=True, parallel=False, fastmath=True, nogil=True)
    def standardDDM_sim (alpha, beta, delta, tau, dt=0.001, var=.1, nTrials=5000):
        choicelist = [np.nan]*nTrials
        rtlist = [np.nan]*nTrials

        updates = np.random.normal(loc=delta*dt, scale=var, size=10000)
        for n in np.arange(0, nTrials):
            t = tau # start the accumulation process at non-decision time tau
            evidence = beta # start our evidence at initial-bias beta
            while evidence < alpha and evidence > -alpha: # keep accumulating evidence until you reach a threshold
                evidence += np.random.choice (updates) # add one of the many possible updates to evidence
                t += dt # increment time by the unit dt
            if evidence > alpha:
                choicelist[n] = 1 # choose the upper threshold action
            else:
                choicelist[n] = 0  # choose the lower threshold action
            rtlist[n] = t
        return pd.DataFrame({'trial': range(1, nTrials+1), 'choice': choicelist, 'rt': rtlist})
